#!/bin/bash

if [[ $# != 1 || $1 == *help ]]
then
  echo "usage: $0 regexp"
  echo "  Builds tests matching the regexp."
  echo "  The EIGEN_MAKE_ARGS environment variable allows to pass args to 'make'."
  echo "    For example, to launch 5 concurrent builds, use EIGEN_MAKE_ARGS='-j5'"
  exit 0
fi

TESTSLIST="clz
rand
meta
maxsizevector
numext
sizeof
dynalloc
first_aligned
type_alias
nullary
mixingtypes_novectorize
mixingtypes_vectorize
float_conversion
io
basicstuff
constexpr
constructor
linearstructure
integer_types
unalignedcount
exceptions
redux_matrix
redux_vector
visitor_matrix
visitor_vector
block_basic
block_extra
corners
symbolic_index
indexed_view
reshape
swap
resize
conservative_resize
diagonalmatrices
diagonalview
skew_symmetric_matrix3
adjoint
diagonal
miscmatrices
commainitializer
smallvectors
mapped_matrix
mapstride
unaryview
mapstaticmethods
array_cwise_operations
array_cwise_operations_int
array_cwise_real
array_cwise_math
array_cwise_bitwise
array_cwise_cast
matrix_cwise
array_for_matrix
array_replicate
array_reverse
ref
is_same_dense
triangular
selfadjoint
nesting_ops_lazy
nesting_ops_eval
nestbyvalue
zerosized
dontalign
evaluators
sizeoverflow
stable_norm
permutationmatrices
bandmatrix
vectorwiseop
special_numbers
rvalue_types
dense_storage
ctorleak
array_of_string
num_dimensions
stl_iterators
initializer_list_construction
diagonal_matrix_variadic_ctor
serializer
tuple_test
realview_dynamic_real
realview_dynamic_cplxfloat
realview_dynamic_cplxdouble
realview_fixed_real
realview_fixed_complex
realview_edge_cases
fastmath
packetmath_float
packetmath_integer
packetmath_complex
packetmath_special
packet_segment
vectorization_logic
blasutil
half_float
bfloat16_float
product_small
product_small_gemm
product_small_lazy_float
product_small_lazy_double
product_large_real
product_large_cplx
product_extra
product_notemporary
product_selfadjoint
product_symm
product_syrk
product_trmv
product_trmm_float
product_trmm_double
product_trmm_cplxfloat
product_trmm_cplxdouble
product_trsolve
product_mmtr
product_threaded
prec_inverse_4x4
assignment_threaded
cholesky
nomalloc
lu
determinant
inverse
inplace_decomposition
qr
qr_colpivoting
qr_cod
qr_fullpivoting
householder
jacobisvd_verify
jacobisvd_trivial_2x2
jacobisvd_misc
jacobisvd_float
jacobisvd_double_fixed
jacobisvd_double_rowmajor
jacobisvd_double_dynamic
jacobisvd_complex
bdcsvd_assert
bdcsvd_trivial
bdcsvd_trivial_2d
bdcsvd_compare
bdcsvd_float_fixed
bdcsvd_float_dynamic
bdcsvd_double_colmajor
bdcsvd_double_semi
bdcsvd_double_rowmajor
jacobi
upperbidiagonalization
random_matrix
eigensolver_selfadjoint_fixed
eigensolver_selfadjoint_3x3_4x4
eigensolver_selfadjoint_dynamic
eigensolver_generic
eigensolver_complex
eigensolver_generalized_real
hessenberg
schur_real
schur_complex
real_qz
complex_qz
geo_orthomethods
geo_quaternion
geo_eulerangles
geo_parametrizedline
geo_alignedbox
geo_hyperplane
geo_transformations
geo_homogeneous
umeyama
sparse_basic
sparse_block
sparse_vector
sparse_product
sparse_ref
sparse_solvers
sparse_permutations
simplicial_cholesky_colmajor
simplicial_cholesky_rowmajor
sparselu
sparseqr
conjugate_gradient
incomplete_cholesky
incomplete_LUT
bicgstab
lscg
stdvector
stdvector_overload
stdlist
stdlist_overload
stddeque
stddeque_overload
threads_eventcount
threads_runqueue
threads_non_blocking_thread_pool
threads_fork_join
NonLinearOptimization
NumericalDiff
autodiff_scalar
autodiff
BVH
matrix_exponential
matrix_function
matrix_power
matrix_square_root
alignedvector3
FFT
EulerAngles
NNLS
sparse_extra
polynomialsolver
polynomialutils
splines
gmres
dgmres
minres
idrs
bicgstabl
idrstabl
levenberg_marquardt
kronecker_product
bessel_functions
special_functions
special_packetmath
cxx11_tensor_argmax
cxx11_tensor_assign
cxx11_tensor_block_access
cxx11_tensor_block_eval
cxx11_tensor_block_io
cxx11_tensor_broadcasting
cxx11_tensor_casts
cxx11_tensor_chipping
cxx11_tensor_comparisons
cxx11_tensor_concatenation
cxx11_tensor_const
cxx11_tensor_contraction
cxx11_tensor_convolution
cxx11_tensor_custom_index
cxx11_tensor_custom_op
cxx11_tensor_dimension
cxx11_tensor_empty
cxx11_tensor_executor
cxx11_tensor_expr
cxx11_tensor_fft
cxx11_tensor_fixed_size
cxx11_tensor_forced_eval
cxx11_tensor_generator
cxx11_tensor_ifft
cxx11_tensor_image_patch
cxx11_tensor_index_list
cxx11_tensor_inflation
cxx11_tensor_intdiv
cxx11_tensor_io
cxx11_tensor_layout_swap
cxx11_tensor_lvalue
cxx11_tensor_map
cxx11_tensor_math
cxx11_tensor_mixed_indices
cxx11_tensor_morphing
cxx11_tensor_move
cxx11_tensor_notification
cxx11_tensor_of_complex
cxx11_tensor_of_const_values
cxx11_tensor_of_strings
cxx11_tensor_padding
cxx11_tensor_patch
cxx11_tensor_random
cxx11_tensor_reverse
cxx11_tensor_reduction
cxx11_tensor_ref
cxx11_tensor_roll
cxx11_tensor_roundings
cxx11_tensor_scan
cxx11_tensor_shuffling
cxx11_tensor_simple
cxx11_tensor_striding
cxx11_tensor_sugar
cxx11_tensor_thread_local
cxx11_tensor_thread_pool_basic
cxx11_tensor_thread_pool_contraction
cxx11_tensor_thread_pool_async
cxx11_tensor_thread_pool_async_contraction
cxx11_tensor_trace
cxx11_tensor_volume_patch
cxx11_tensor_uint128
"
targets_to_make=$(echo "$TESTSLIST" | grep -E "$1" | xargs echo)

if [ -n "${EIGEN_MAKE_ARGS:+x}" ]
then
  /usr/bin/ninja $targets_to_make ${EIGEN_MAKE_ARGS}
else
  /usr/bin/ninja $targets_to_make 
fi
exit $?

